<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>DNF战令经验估算</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Import style -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <!-- Import Vue 3 -->
    <script src="https://unpkg.com/vue@3"></script>
    <!-- Import component library -->
    <script src="https://unpkg.com/element-plus"></script>
    <style>
      .item {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
      }
      .label {
        font-size: 12px;
        margin-right: 12px;
        white-space: nowrap;
      }
    </style>
</head>

<body>
  <div id="app">
    <div class="item"><label class="label">当前日期：</label><el-input type="date" v-model="nowDate" /> 距离{{lastDate}}还有{{days}}天</div> 
    <div class="item"><label class="label">当前等级：</label><el-input v-model.number="currentLevel" type="number" /></div>
    <div class="item"><label class="label">距离满级所需经验：</label><div v-text="stillNeed"></div></div>
    <div class="item"><label class="label">全勤可获取经验（仅包含每日/每周任务）：</label><div v-text="dailyEX" ></div></div>
    <div class="item"><label class="label">还需经验（通过赛季任务或充值）：</label><div v-text="gap"></div></div>
  </div>

  <script type="module">
    import LEVEL from './level.js'
    const { createApp } = Vue
    
    const app = createApp({
      data() {
        return {
          lastDate: '2022-12-21',
          nowDate: '2022-' + (new Date().getMonth() + 1) + '-' + new Date().getDate(),
          currentLevel: 2
        }
      },
      computed: {
        stillNeed() {
          if(!this.currentLevel) {
            return 0
          }
          let ex = 0
          for(i = this.currentLevel; i <= 101; i++) {
            ex += LEVEL[i]
          }
          return ex
        },
        days() {
          return ((new Date(this.lastDate).getTime() - new Date(this.nowDate).getTime()) / 1000 / 60 / 60 / 24) >> 0
        },
        dailyEX() {
          let newDate = new Date(this.nowDate).getTime()
          let lastDate = new Date(this.lastDate).getTime()
          let ex = 0
          while(newDate < lastDate) {
            const day = new Date(newDate).getDay()
            if(day === 6 || day === 0) {
              ex += (600 * 6)
            } else {
              ex += (400 * 6)
            }
            if(day === 4) {
              ex += (4500 * 3)
            }
            newDate += (1000 * 60 * 60 *24)
          }

          return ex
        },
        gap() {
          if(!this.currentLevel) {
            return 0
          }
          return this.stillNeed - this.dailyEX
        },
      }
    })
    app.use(ElementPlus)
    app.mount('#app')
  </script>
</body>
</html>